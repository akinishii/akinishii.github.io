<html>

<head>

<title>気象データ解析のためのPython環境構築(Windows) - NISHII, Akira's Page</title>
<meta charset="utf-8"></meta>
<!-- CSSやJSたち -->
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js?skin=sunburst"></script>
<link href="../../css/carousel.css" rel="stylesheet">

<script src="../../main.js"></script>

<style>
.prettyprint ol.linenums > li {
    list-style-type: decimal; 
}

.cimg{text-align: center;}

.nomagin{margin-left: 0px;}

p {margin-left: 25px;}
</style>
    
</head>

<body>
    
<script>header("Tech", "jp")</script>

<main style="padding-top: 50pt;">

<div class="container">
<li><a href="../python3.html">Python3のぺージに戻る</a></li>
<h2>気象データ解析のためのPython環境構築(For Windows)</h2>
<p><a href="install_anacon_py.html">*Linuxの方はこちらへ</a></p>
<p><a href="install_anacon_py_mac.html">*Macの方はこちらへ</a></p>
<p>このページでは2022年度のVL講習会向けに，Anacondaを使ってPython環境構築する場合の一例をまとめています。<br>
   Windows 10の場合を紹介していますが，11でも同様の方法でインストールできます。</p>
<p><b>*全部インストールすると10 GB近くになります。インストール前にHDD(SSD)の容量確認することをおすすめします。</b></p>
<!-- <p>某講習会に必要じゃないけど気象データ解析に使いそうなライブラリとかは『6.その他』にまとめています。</p> -->

<ol type="1">
<h4><li>Anacondaをインストールする</li></h4>
<p><a href="https://www.anaconda.com/products/individual#Downloads" target="_blank" rel="noopener noreferrer">ここ</a>からAnacondaのインストーラをダウンロードする。その後，ダウンロードしたインストーラを実行する。</p>
<div class="cimg">
<img src="./pywin_fig/pywin_001.jpg" width=500 alt="インストール">
<p class="nomagin">"64-Bit Graphical Insteller"を選択</p>
<img src="./pywin_fig/pywin_002.jpg" width=500 alt="インストール">
<p class="nomagin">インストーラーを実行するとこのような画面が表示される。<br>"Next"をクリックして次へ</p>
<img src="./pywin_fig/pywin_003.jpg" width=500 alt="インストール">
<p class="nomagin">"I Agree"をクリックすると次にすすむ</p>
<img src="./pywin_fig/pywin_004.jpg" width=500 alt="インストール">
<p class="nomagin">"Next"をクリックして次へ</p>
<img src="./pywin_fig/pywin_005.jpg" width=500 alt="インストール">
<p class="nomagin">anacondaのインストール先を指定し，"Next"をクリック<br>*ほとんどの場合そのままで大丈夫</p>
<img src="./pywin_fig/pywin_006.jpg" width=500 alt="インストール">
<p class="nomagin">指定したインストール先にスペースが入っているとNextクリック後このようなメッセージが表示される<br>"OK"を押すことで次にすすめる(今回はこのメッセージを無視する)</p>
<img src="./pywin_fig/pywin_007.jpg" width=500 alt="インストール">
<p class="nomagin">"Register Anaconda3 as the~"だけ有効にする(AnacondaのPythonをデフォルトのPythonにする)</p>
<img src="./pywin_fig/pywin_008.jpg" width=500 alt="インストール">
<p class="nomagin">インストールには数分かかる<br>完了後，"Next"をクリック</p>
<!--<img src="./pywin_fig/pywin_009.jpg" width=500 alt="インストール"></div>-->
<img src="./pywin_fig/pywin_010.jpg" width=500 alt="インストール">
<p class="nomagin">"Next"をクリック</p>
<img src="./pywin_fig/pywin_011.jpg" width=500 alt="インストール">
<p class="nomagin">図では片方チェック入っているが，どちらも外してから"Finish"をクリック</p>
<img src="./pywin_fig/pywin_012.jpg" width=500 alt="インストール">
<p>Windowsの検索機能で"anaconda"と検索するといくつかツールが出てくる<br>
   今回は"Anaconda Prompt (anaconda3)"を使用し環境構築をおこなう *Anaconda Powershell Promptでもよい</p>
</div>

<h4><li>解析用の仮想環境を構築する</li></h4>
<p>仮想環境を構築し，必要なライブラリのみをインストールすることでバージョン管理などが容易になる。仮想環境の構築はAnaconda Prompt上で以下のように実施する。</p>
<pre class="prettyprint linenums:1 lang-bash">conda create -n vl_lab -c conda-forge python=3.9</pre>
<p>途中"Proceed ([y]/n)?"ときかれる。yを入力してからエンターを押すと仮想環境構築が始まる。</p>
<p>この場合"vl_lab"という名前の環境が作られ，環境構築時にpython3.9がインストールされる(vl-labは任意の名前に変えても良い)。-nは環境名を指定するオプション，-cはライブラリのインストール元を指定すオプションである(今回はconda-forgeを使う)。</p>



<h4><li>構築した仮想環境への移動</li></h4>
<p>以降，"vl_lab"という仮想環境を作ったものとする。conda activateを実行することで仮想環境に切り替わる。</p>
<pre class="prettyprint linenums:2 lang-bash">
(base) conda activate vl_lab
(vl_lab) #Activateした仮想環境に切り替わる
</pre>


<h4><li>研究に必要なツールのインストトール</li></h4>
<p>気象データの解析に必要なライブラリをvl_lab環境にインストールする。numpyやmatplotlibなど主要なものは以下のものをインストールする際に依存関係(あるライブラリが動作するために必要なライブラリ)で一緒にインストールされる。</p>
<p><u>仮想環境がvl_labであることを確認した後</u>(ターミナルの先頭が(vl_lab)であれば良い)，以下のコマンドを順番に実行する。-c conda-forgeはconda-forgeからインストールすることを示し，-yはインストールの確認をスキップするオプションである。</p>
<ul>
   <li>netCDF4 (ERA5などで使われているデータ形式であるnetCDFを扱うためのライブラリ) <a href="http://unidata.github.io/netcdf4-python/" target="_blank" rel="noopener noreferrer">公式ドキュメント</a></li>
   <pre class="prettyprint linenums:3 lang-bash">conda install -y -c conda-forge netCDF4</pre>
   <li>cfgrib  (JRA-55などのデータ形式であるGRIBを扱うためのライブラリ) <a href="https://github.com/ecmwf/cfgrib" target="_blank" rel="noopener noreferrer">公式ドキュメント</a>(GitHub)</li>
   <pre class="prettyprint linenums:4 lang-bash">conda install -y -c conda-forge cfgrib</pre>
   <li>jupyterlab (Pythonの開発・実行環境) <a href="https://docs.jupyter.org/en/latest/" target="_blank" rel="noopener noreferrer">公式ドキュメント</a></li>
   <pre class="prettyprint linenums:5 lang-bash">conda install -y -c conda-forge jupyterlab</pre>
   <li>metpy (気象データの解析に特化したライブラリ) <a href="https://unidata.github.io/MetPy/latest/index.html" target="_blank" rel="noopener noreferrer">公式ドキュメント</a></li>
   <pre class="prettyprint linenums:6 lang-bash">conda install -y -c conda-forge metpy</pre>
</ul>


<h4><li>ライブラリがインストールできたかどうか確認する</li></h4>
<p>ここではpython3のインタラクティブモードでライブラリをインポートすることにより確認する。 *#はコメント(入力しなくて良い)</p>
<pre class="prettyprint linenums:7 lang-python">
(vl_lab) python
#Python 3.9.10 | packaged by conda-forge | (main, Feb  1 2022, 21:22:07) [MSC v.1929 64 bit (AMD64)] on win32
#Type "help", "copyright", "credits" or "license" for more information.
>>> import numpy
>>> import matplotlib
>>> import pandas
>>> import xarray
>>> import cfgrib
>>> import metpy
>>> import netCDF4
>>> exit() #インタラクティブモードを終了する。
</pre>
<p>エラーメッセージ等が表示されなければインストールが成功している。</p>
<p>"ModuleNotFoundError: No module named ライブラリ名" とエラーが出てきた場合，そのライブラリを再度conda installによりインストールしてからもう一度確認してみる。</p>


<h4><li>conda-forgeからのインストールを最優先させる</li></h4>
<p>先ほどはcオプション(-c conda-forge)により全てのライブラリをconda-forgeからインストールするよう指定していた。cオプションで指定しなかった場合，初期設定ではDefaultsチャンネルからインストールするようになっている。Defaultsチャネルとconda-forgeチャネルのライブラリは互換性はあるが100%ではないため，混ぜると不具合が生じることがある。</p>
<p>したがって，ここではデフォルトで全てのライブラリをconda-forgeからインストールするための設定をおこなう。</p>
<pre class="prettyprint linenums:8 lang-python">
conda config --add channels conda-forge    #conda-forgeをインストール時に最優先で参照するチャネルとして追加
conda config --set channel_priority strict #conda-forgeから全てのライブラリや依存関係をインストールする
conda config --get channels                #現在のチャンネル設定の表示
#--add channels 'defaults'   # lowest priority
#--add channels 'conda-forge'   # highest priority
</pre>
<p>以上により，conda-forgeが最優先で参照するチャネルとなった。これ以降，-c conda-forgeを入力しなくてもconda-forgeからインストールされるようになる。</p>
<p>参考：<a href="https://conda-forge.org/docs/user/tipsandtricks.html#using-multiple-channels" target="_blank" rel="noopener noreferrer">Conda-forgeドキュメント(Using multiple channels)</a></p>



<h4><li>その他(以下の設定は任意)</li></h4>
<h5>・Anaconda Prompt起動時にbase環境ではなく解析環境を起動させる</h5>
<p>デフォルトではAnaconda Promptを開いた際に(base)環境が起動するようになっている。最初から解析環境を起動させたい場合は以下の通りショートカットキーのリンク先変更する。</p>
<p>*Win10と11でやり方は同じ。Anaconda Powershell Promptでも同様の方法で設定できる。</p>

<div class="cimg">
<img src="./pywin_fig/pywin_set_001.jpg" width=500 alt="インストール">
<p class="nomagin">メニュー上でAnaconda Promptを右クリックし，ファイルの場所を開く</p>
<img src="./pywin_fig/pywin_set_002.jpg" width=500 alt="インストール">
<p class="nomagin">Anaconda Promptを右クリックし，プロパティを選択</p>
<img src="./pywin_fig/pywin_set_003.jpg" width=500 alt="インストール">
<p class="nomagin">ショートカットタブを選択し，リンク先の最後の方に仮想環境のパスを追記する。</p>
</div>
<p>これによりターミナル起動時に"conda acitvate vl_lab"が実行されるようになる。Anaconda Promptを再起動すると最初から解析環境になっているはず。</p>

<h5>・その他気象データ解析に使いそうなライブラリのインストール</h5>
<p>以下は必要に応じてインストールしてください</p>
<ul>
   <li>Py-ART: 気象レーダデータ解析・可視化ライブラリ<a href="https://arm-doe.github.io/pyart/notebook-gallery.html" target="_blank" rel="noopener noreferrer">公式ドキュメント</a></li>
   <p>*日本のレーダデータを処理するにはCF-Radial形式等に変換をする必要がある。</p>
   <pre class="prettyprint lang-bash">conda install -y -c conda-fogre arm_pyart</pre>
   <li>PyBufrKit: PythonでBUFRフォーマットのデータ(気象庁ウィンドプロファイラ等)をデコードする <a href="https://pybufrkit.readthedocs.io/en/latest/" target="_blank" rel="noopener noreferrer">公式ドキュメント</a></li>
   <p>anacondaにないのでpipからインストールする</p>
   <pre class="prettyprint lang-bash">pip install pybufrkit</pre>
   <li>Satpy: 衛星データの処理・可視化ライブラリ <a href="https://satpy.readthedocs.io/en/stable/index.html" target="_blank" rel="noopener noreferrer">公式ドキュメント</a></li></li>
   <pre class="prettyprint lang-bash">conda install -y -c conda-forge satpy</pre>
</ul>

</ol>
</div>

<div class="container">
<hr class="featurette-divider">
</div>

<script>footer()</script>

</main>

</body>

</html>